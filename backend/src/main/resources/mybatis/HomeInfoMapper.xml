<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.home.mapper.HomeInfoMapper">

	<select id="getHousesByDong" resultType="HomeInfo">
	  SELECT h.apt_seq     AS aptSeq,
	         h.apt_nm      AS aptName,
	         h.road_nm     AS roadNm,
	         h.road_nm_bonbun AS roadNmBonbun,
	         h.road_nm_bubun AS roadNmBubun,
	         h.build_year  AS buildYear,
	         h.latitude,
	         h.longitude
	    FROM houseinfos h
	   WHERE h.sgg_cd = LEFT(
	                     (SELECT dong_code
	                      FROM dongcodes
	                      WHERE sido_name = #{sido}
	                        AND gugun_name = #{gugun}
	                        AND dong_name = #{dong}
	                      LIMIT 1),
	                     5)
	     AND h.umd_cd = RIGHT(
	                     (SELECT dong_code
	                      FROM dongcodes
	                      WHERE sido_name = #{sido}
	                        AND gugun_name = #{gugun}
	                        AND dong_name = #{dong}
	                      LIMIT 1),
	                     5)
	     AND h.latitude IS NOT NULL
	  ORDER BY h.apt_nm
	</select>
	
	<!-- 아파트 이름만 검색 -->
	<select id="findAllAptByName" resultType="com.ssafy.home.dto.HomeInfo">
	  SELECT * FROM houseinfos
	  WHERE apt_name LIKE CONCAT('%', #{aptName}, '%')
	</select>


  <select id="getSidoList" resultType="string">
    SELECT DISTINCT sido_name
      FROM dongcodes
     ORDER BY sido_name
  </select>

  <select id="getGugunList" resultType="string">
    SELECT DISTINCT gugun_name
      FROM dongcodes
     WHERE sido_name = #{sido}
       AND gugun_name IS NOT NULL
     ORDER BY gugun_name
  </select>

  <select id="getDongList" resultType="string">
    SELECT DISTINCT dong_name
      FROM dongcodes
     WHERE gugun_name = #{gugun}
       AND dong_name IS NOT NULL
     ORDER BY dong_name
  </select>

</mapper>
